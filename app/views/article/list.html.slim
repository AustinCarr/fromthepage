=render({ :partial => '/shared/collection_tabs', :locals => { :selected => 6, :collection_id => @collection.id }})

.collection-categories
  .category-tree
    ==display_categories(@collection.categories, nil) do |category|
      -ret = "<a href=\"#cat_#{category.id}\" class=\"tree-item\">"
      -if category.children.any?
        -ret << "<span class=\"tree-bullet\"></span>"
      -ret << "<span>#{category.title}</span>"
      -ret << "</a>"
    ul
      li: a.tree-item(href="#cat_none") Uncategorized

  .category-articles
    -@collection.categories.each do |category|
      dl(id="cat_#{category.id}")
        dt: h3 ==(category.ancestors.reverse.push(category).map { |c| c.title }).join(" &rarr; ")
        dd
          -category.articles.each do |article|
            =link_to article.title, { :action => 'show', :article_id => article.id }

    dl#cat_none
      dt: h3 Uncategorized Articles
      dd
        -@uncategorized_articles.each do |article|
          =link_to article.title, { :action => 'show', :article_id => article.id }

javascript:
  $(function() {
    $(window).on('hashchange', function() {
      var selected = window.location.hash || $('.tree-item:first').attr('href');
      var $tree_item = $('.tree-item[href="'+selected+'"]');

      if($tree_item.length !== 0) {
        $tree_item.parentsUntil('.category-tree', 'li').addClass('expanded');
        $('.tree-item.selected').removeClass('selected');
        $tree_item.addClass('selected');
        $(selected).show().siblings().hide();
      }
    }).trigger('hashchange');

    $('.tree-bullet').on('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      $(this).closest('li').toggleClass('expanded');
    });
  });
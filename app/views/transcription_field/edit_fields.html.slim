=render({ :partial => '/shared/collection_tabs', :locals => { :selected => 10, :collection_id => @collection.id }})

h2.nomargin Edit Transcription Fields
.toolbar.aright
  .toolbar_group
    =button_tag 'Add Additional Field', type: 'button', id: 'add-field'

=form_tag add_fields_path
  =hidden_field_tag(:collection_id, @collection.id)
  p Separate multiple options for a select field by semicolons.
  table.field_form#new-fields
    thead
      th =label_tag :line_number, 'Line', class: 'first'
      th =label_tag :label
      th =label_tag :input_type
      th =label_tag :options, "Separate multiple select field options with semicolons"
    tbody
      -unless @current_fields.blank?
        -@current_fields.each do |f|
          =render ({ partial: 'new_field_form', locals: {collection_id: @collection, field: f}})
      -else
        -3.times do
          =render ({ partial: 'new_field_form', locals: {collection_id: @collection}})
  .toolbar.aright
    .toolbar_group
      =button_tag 'Save', name: 'save', type: 'submit', class: 'button fields'
      =link_to 'Cancel', edit_collection_path(@collection.owner, @collection), class: 'button fields'
      =button_tag 'Done', name: 'done', type: 'submit', class: 'button fields'

h2.acenter Preview
=render ({partial: 'field_layout', locals: {collection_id: @collection}})

=render({ :partial => '/shared/collection_footer' })

-content_for :javascript
  javascript:
    $(function() {

      $('#add-field').click(function(e){
        $('#new-fields').append("#{j render partial: 'new_field_form', locals: {collection_id: @collection}}").on('change', '.input_type', function(){addOptions(this)});
      });

      $('table#new-fields tbody tr').each(function(){
        var optionsObj = $(this).find('td .field-options')[0];
        var index = $(this).find('td .input_type')[0].options.selectedIndex;
        if (index == 1){
          $(optionsObj).prop('disabled', false);
        }
      })
      
      $('.input_type').change(function(){
          addOptions(this);
      });

      function addOptions(selector){
        var parentTr = selector.parentElement.parentElement;
        var optionsObj = $(parentTr).find('td .field-options')[0];
        var index = selector.options.selectedIndex;
        if (index == 1){
          $(optionsObj).prop('disabled', false);
        } else {
          $(optionsObj).prop('disabled', true);
        }
      };

    });
